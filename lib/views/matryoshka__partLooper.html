<template name="matryoshka__partLooper">

	<div class="matryoshka__nestable__container {{ nestableGetCssClasses }}">

		<div class="matryoshka__nestable__container__col matryoshka__nestable__container__col--left">

			<h3>{{ nestableNameReadable }}</h3>

			<button class="matryoshka__nestable__container__button matryoshka__nestable__container__button--absolute delete-part">
				<i class="fa fa-times"></i>
			</button>
			<button class="matryoshka__nestable__container__button matryoshka__nestable__container__button--absolute move-part move-part-up" data-move-where="down">
				<i class="fa fa-arrow-up"></i>
			</button>
			<button class="matryoshka__nestable__container__button matryoshka__nestable__container__button--absolute move-part move-part-down" data-move-where="up">
				<i class="fa fa-arrow-down"></i>
			</button>

		</div>

		<div class="matryoshka__nestable__container__col matryoshka__nestable__container__col--right matryoshka__nestable__container__col--{{ this.matryoshkaId }}">
	
			{{#each fields }}

				<label for="{{ ../matryoshkaId }}-{{this.name}}">{{ this.name }}:</label> 
				{{#if ifValueEquals this.type "text" }}
					<input id="{{ ../../matryoshkaId }}-{{this.name}}" data-parent-id="{{ ../../matryoshkaId }}" class="matryoshka-save-on-blur" type="text" value="{{ getFieldValue ../..}}" />
				{{/if}}
				{{#if ifValueEquals this.type "linkedNestable" }}
					<strong><a href="/matryoshka/edit/{{ getFieldValue ../..}}">{{ getLinkedNestableName ../..}}</a></strong>
				{{/if}}
				{{#if ifValueEquals this.type "locked" }}
					<strong>{{ getFieldValue ../..}}</strong>
				{{/if}}
				{{#if ifValueEquals this.type "textarea" }}
					<textarea id="{{ ../../matryoshkaId }}-{{this.name}}" data-parent-id="{{ ../../matryoshkaId }}" class="matryoshka-save-on-blur">{{ getFieldValue ../..}}</textarea>
				{{/if}}

				{{#if ifValueEquals this.type "select" }}

					<select id="{{ ../../matryoshkaId }}-{{this.name}}" data-parent-id="{{ ../../matryoshkaId }}" class="matryoshka-save-on-select">

						<option value="not-selected">-</option>

						{{#each selectableData }}

							<option 
								value="{{ name }}" 
								selected="{{ ifSelectValueEquals ../../../matryoshkaId ../name name }}"
								>
								{{ name }}
							</option>

						{{/each}}

					</select>

					{{ setActiveSelectValue ../../matryoshkaId ../.. name }}

				{{/if}}

				{{#if this.imagePreview }}
					<img class="matryoshka__form__image-preview" src="{{ getFieldValue ../.. }}" alt="Linked image preview" />
				{{/if}}

				<div class="matryoshka__form__clearfix"></div>

			{{/each}}

			{{#each fieldsTypeSpecific }}

				{{#if fieldsTypeSpecific__hasFieldsBool .. }}

					{{#each fieldsTypeSpecific__getFields ../.. }}

						<label for="{{ ../../../matryoshkaId }}-{{this.name}}">{{ this.name }}:</label> 
						{{#if ifValueEquals this.type "text" }}
							<input id="{{ ../../../matryoshkaId }}-{{this.name}}" data-parent-id="{{ ../../../matryoshkaId }}" class="matryoshka-save-on-blur" type="text" value="{{ getFieldValue ../../.. }}" />
						{{/if}}
						{{#if ifValueEquals this.type "locked" }}
							<strong>{{ getFieldValue ../../.. }}</strong>
						{{/if}}
						{{#if ifValueEquals this.type "linkedNestable" }}
							<strong><a href="/matryoshka/edit/{{ getFieldValue ../../.. }}">{{ getLinkedNestableName ../../.. }}</a></strong>
						{{/if}}
						{{#if ifValueEquals this.type "textarea" }}
							<textarea id="{{ ../../../matryoshkaId }}-{{this.name}}" data-parent-id="{{ ../../../matryoshkaId }}" class="matryoshka-save-on-blur">{{ getFieldValue ../../.. }}</textarea>
						{{/if}}
						{{#if ifValueEquals this.type "select" }}

							<select id="{{ ../../../matryoshkaId }}-{{this.name}}" data-parent-id="{{ ../../../matryoshkaId }}" class="matryoshka-save-on-select">

								<option value="not-selected">-</option>

								{{#each selectableData }}

									<option 
										value="{{ name }}" 
										selected="{{ ifSelectValueEquals ../../../../matryoshkaId ../name name }}"
										>
										{{ name }}
									</option>

								{{/each}}

							</select>

							{{ setActiveSelectValue ../../../matryoshkaId ../../.. this.name }}

						{{/if}}

					{{/each}}

				{{/if}}

			{{/each}}

		</div>

			{{#if nestables }}

				<div class="matryoshka__nestable__container__col matryoshka__nestable__container__col--parts">
					
					<div class="matryoshka__nestable__container__add-part-container">

						<div class="matryoshka__nestable__container__add-part-container__inner">

							{{#each nestables }}

								<div class="matryoshka__nestable__container__add-part-container__inner__part">

									<h2>Add new {{ name }}</h2>

									{{#each actualNestablesInArray }}

											<button 
												data-parent-id="{{ ../../matryoshkaId }}" 
												class="matryoshka__nestable__container__button add-part">
												<i class="fa fa-file-o"></i> {{ nestableNameReadable }}
											</button>

									{{/each}}

								</div>

								<div class="matryoshka__nestable__container__add-part-container__inner__part">

									<h2>Add predefined {{ name }}</h2>

									{{#each actualNestablesInArray }}

										{{#each savedNestableParts }}

											<button 
												data-parent-id="{{ ../../../matryoshkaId }}" 
												class="matryoshka__nestable__container__button add-predefined-part">
												<i class="fa fa-chain"></i> {{ matryoshkaName }}
											</button>

										{{/each}}

									{{/each}}

								</div>

							{{/each}}

						</div>

						<div class="matryoshka__nestable__container__add-part-container__extra-fader"></div>

					</div>

					{{#each nestables }}

						{{#each actualNestables .. }}

							{{> recurse dataToRecurse }}

						{{/each}}

					{{/each}}

					<div class="matryoshka__clearfix">	</div>

					<button class="matryoshka__nestable__container__button show-part-list"><i class="fa fa-plus"></i> Add parts to {{ type }}</button>

				</div>

			{{/if}}

	</div>

</template>
